<html>
<script type="text/javascript" src="js/d3.min.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>


<body>

<script>
    var webSocket = new WebSocket("ws://localhost:3000");
    var pastRectangle = [];
    var bardata = []; //array that holds the current value for the candlestick chart
    var oneMinuteArray = []; //this array will hold data to draw candlesticks at 1 minute
    
	webSocket.onopen = function (event)
	{
		console.log('Websocket connection open'); //when the connection is established log this message to the console
	};
	
	webSocket.onclose = function()
	{
		console.log("closed")
	}
				
	webSocket.onmessage = function (event)
	{
		var e = JSON.parse(event.data); //the data will be retrieved as a JSON string this will parse the data out of that string
		var data = e;
		if(data !== null && typeof data === 'object') //if the data recieved is not null and is of type object
		{
			pastRectangle.push(data); //push this to the pastRectangle array, this will be used to draw historical data
		}else
		{
		oneMinuteArray.push(data); 
		bardata.push(data); //this array will containt the current price every second
		//console.log(e)
		}
	}

	webSocket.close = function(event)
	{
		console.log("connection closed");
	}



		var height = window.innerHeight
			, width = window.innerWidth
			, barWidth = 50
			, barOffset = 5;

		var scale = d3.scale.linear()
			.range([0, height])
			.domain([0, height]);


		var svg = d3.select('body')
			.append('svg')
			.attr('width', width)
			.attr('height', height)
			.style('background', '#C9D7D6')

		function update(bardata)
		{

			var rect = 	svg
					   .selectAll('rect')
					   .data(bardata);

				 rect
				.enter()
				.append("rect")
				.attr("x", width/2)
				.attr("y", height/2-bardata)
				.attr("height", bardata)
				.attr("width", 60)
				.attr("fill", "green")
			
				 rect
				.transition()
				.duration(1000)
				.ease('linear')
				.attr("height", function (d){return d});			
		}

		setInterval(function ()
		{
			update(bardata); //call the update method everysecond with the latest price
			bardata.shift(); //remove the first index of the array, used to insure array only ever has one value
		}, 1000)
		

		
		
		
	</script>
	<div class="message">
		
	</div>
	


</body>

</html>