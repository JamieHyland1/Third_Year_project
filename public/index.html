<html>
<script type="text/javascript" src="js/d3.min.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>


<body>

<script>
		var webSocket = new WebSocket("ws://localhost:3000");
		var data = [1];
		var bardata = []; //array that holds the current value for the candlestick chart
		var oneMinuteArray = []; //this array will hold data to draw candlesticks at 1 minute
		var open = oneMinuteArray[0];
		var close = oneMinuteArray[oneMinuteArray.length-1];

		webSocket.onopen = function (event) {
			console.log('Websocket connection open');
		};
		
		
				
	    webSocket.onmessage = function (event)
		{
			var e = JSON.parse(event.data);
			var high = e;
			oneMinuteArray.push(high);
			bardata.push(high);
		}
			
		setInterval(function()
		{
			sendData(oneMinuteArray)

		},60000);
		
		
		function sortNumber(a,b)
		{
    	 return a - b;
		}
		setTimeout(function()
		{
			console.log(data)
		},60001)
		function sendData(array)
		{
				 var open = array[0];
				 var close = array[array.length-1];
			     array.sort(sortNumber);
				 var high = array[array.length-1];
				// console.log(high)
				 var low = array[0];
				// console.log(high)
				 var obj = {"high": high, "low": low, "open": open, "close": close};
				 var msg = JSON.stringify(obj)
				 webSocket.send(msg)
				 data.push(bardata);
				 oneMinuteArray = [];
		}

		webSocket.close = function(event)
		{
			console.log("closed");
		}



		var height = window.innerHeight
			, width = window.innerWidth
			, barWidth = 50
			, barOffset = 5;

		var scale = d3.scale.linear()
			.range([0, height])
			.domain([0, height]);


		var svg = d3.select('body')
			.append('svg')
			.attr('width', width)
			.attr('height', height)
			.style('background', '#C9D7D6')

		function update(bardata)
		{

			var rect = svg.selectAll('rect').data(data);

			rect.enter()
				.append("rect")
				.attr("x", width/2)
				.attr("y", height/2-bardata)
				.attr("height", bardata)
				.attr("width", 60)
				.attr("fill", "green")
			
				rect.transition()
					.duration(1000)
					.ease('linear')
					.attr("height", function (d){return d});
			
				//console.log(bardata);
		}

		setInterval(function ()
		{
			update(bardata);
			bardata.shift();
		}, 1000)
		

		
		
		
	</script>
	<div class="message">
	</div>
	


</body>

</html>