<html>
<script type="text/javascript" src="js/d3.min.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>


<body>

	<script>
		var webSocket = new WebSocket("ws://localhost:3000");


		webSocket.onopen = function (event) {
			console.log('Websocket connection open');
		};

		var bardata = []; //array that holds the current value for the candlestick chart
		var fiveMinuteArray = []; //this array will hold data to draw candlesticks at 5 minutes
		var oneMinuteArray = []; //this array will hold data to draw candlesticks at 1 minute
		var open = oneMinuteArray[0]; //get the open
		var close = oneMinuteArray[oneMinuteArray.length-1];
		var high = getHigh(oneMinuteArray);
		var low = getLow(oneMinuteArray);
		setTimeout(function(){console.log(low)}, 10000)
		getHigh(oneMinuteArray);
		setInterval(function(){
			
			
			oneMinuteArray = [];
			},60000);
		
		
		function getHigh(array)
		{
			array.sort();
			return array[array.length-1]
		}
		function getLow(array)
		{	
			setInterval(function(){array.sort();
			console.log("The smallest number in the array is " + array[0] +
						"\n The largest number in the array is: " + oneMinuteArray[array.length-1]);
								   		webSocket.send(oneMinuteArray)

			},60000)
			return array[0]
		}

		webSocket.onmessage = function (event) {
			var e = JSON.parse(event.data);
			var high = e;
		//	console.log("one minute array: " + oneMinuteArray);
			//console.log("five minute array: " + fiveMinuteArray);
			oneMinuteArray.push(high);
			fiveMinuteArray.push(high);
			bardata.push(high);
		}
		webSocket.close = function(event){
			console.log("closed");
		}



		var height = 500
			, width = 500
			, barWidth = 50
			, barOffset = 5;

		var scale = d3.scale.linear()
			.range([0, height])
			.domain([0, height]);


		var svg = d3.select('body').append('svg')
			.attr('width', width)
			.attr('height', height)
			.style('background', '#C9D7D6')

		function update(bardata) {


			var rect = svg.selectAll('rect').data([bardata]);

			rect.enter()
				.append("rect").attr("x", width/2).attr("y", height/2).attr("height", function (d) {
					return d
				})
				.attr("width", 60)
				.attr("fill", "green")
			rect.transition().duration(1000).ease('linear').attr("height", function (d) {
				return d
			});



			
			console.log(bardata);

		}
		setInterval(function () {
			update(bardata);
			
			bardata.shift();
		}, 1000)
	</script>
	<div class="message">
	</div>
	


</body>

</html>