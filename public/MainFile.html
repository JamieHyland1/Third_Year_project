<!--Doctype html-->
<!--Eleanor Noonan N00147653 iadt.ie -->
<html>
<style>
    svg {
        /* color: #fff;*/
        font: 8px sans-serif;
        shape-rendering: crispEdges;
        background: url('../images/world-dots-map2.png');
    }
</style>

<head>
    <title>Stock Watch Application</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="http://d3js.org/d3.v2.min.js"></script>
    <!--linking style sheet-->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="styles/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="styles/myWebsiteStyles.css">
    <!--custom CSS-->


    <!--link to fonts-->
    <link href='https://fonts.googleapis.com/css?family=Alex+Brush|Julius+Sans+One|Khula|Nixie+One|Telex|Neucha|Cinzel+Decorative|Tenor+Sans|Petit+Formal+Script|Roboto+Condensed|Source+Sans+Pro' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,300,100,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,300,100,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
    <!--<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css"><!--for pure css plugins if used-->


    <!--using CDN because dropdown elements of bootstrap not operating correctly without-->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="styles/myWebsiteStyles.css">


    <script type="text/javascript">
        function ShowAsset1() {
            document.getElementById("assetbox").innerHTML = "Alphabet"; //it's calling the textarea id repeat for 3 now
            console.log("alphabet");
        }

        function ShowAsset2() {
            document.getElementById("assetbox").innerHTML = "Apple Inc"; //it's calling the textarea id repeat for 3 now
            console.log("apple");
        }

        function ShowAsset3() {
            document.getElementById("assetbox").innerHTML = "Bitcoin"; //it's calling the textarea id repeat for 3 now
            console.log("bitcoin");
        }

        function ShowAsset4() {
            document.getElementById("assetbox").innerHTML = "Microsoft"; //it's calling the textarea id repeat for 3 now
            console.log("microsoft");
        }
    </script>
</head>

<body>
    <!--code for container 12 column BS grid-->
    <div class="container-fluid">


        <div class="col-lg-12 col-md-6">
            <div class="toppanel" id="top">

                <div class="col-lg-2 logo">
                    <img src="/images/bullnbear3.jpg" class="img-rounded" alt="Bull Bear Logo">
                </div>


                <div class="col-lg-2 add">
                    <div class="col-lg-2 "><textarea id="assetbox" readonly></textarea></div>
                    <div class="col-lg-2 col-lg-offset-6">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><img src="images/add2.png"></button>

                            <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu1" onchange='ShowAsset()'>
                                <li><a href="#" onclick="ShowAsset1()" id="asset">Alphabet</a></li>
                                <li><a href="#" onclick="ShowAsset2()" id="asset">Apple Inc</a></li>
                                <li><a href="#" onclick="ShowAsset3()" id="asset">Bitcoin</a></li>
                                <li><a href="#" onclick="ShowAsset4()" id="asset">Microsoft</a></li>
                            </ul>

                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-lg-2 col-md-1">
            <div class="container" id="left">

                <div class="col-lg-2">
                    <div class="row" id="topset">
                        <div class="col-lg-2">
                            <div class="row">
                                <div class="btn-group-vertical dropdown-toggle" role="group" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                    <button type="button" class="btn btn-default"><img src="images/closeIcon.png"></button>
                                    <button type="button" class="btn btn-default"><img src="images/gridLayoutIcon.png"></button>
                                    <button type="button" class="btn btn-default"><img src="images/maximize.png"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            </br>
            <div class="container" id="left2">
                <div class="col-lg-2">
                    <div class="row" id="bottomset">
                        <div class="col-lg-2">
                            <div class="row">
                                <div class="btn-group-vertical dropdown-toggle" role="group" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                    <button type="button" class="btn btn-default"><img src="images/timeicon.png"></button>
                                    <button type="button" class="btn btn-default"><img src="images/chartIcon.png"></button>
                                    <button type="button" class="btn btn-default"><img src="images/IndicatorsIcon.png"></button>
                                    <button type="button" class="btn btn-default"><img src="images/graphicalToolsIcon.png"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>




        <div class="col-lg-8 col-md-4">
            <div class="centralpanel" id="chart">
                <!--<h2>center panel for charts</h2>-->
                <script type="text/javascript">
                    
                 var webSocket = new WebSocket("ws://localhost:3000");
		
     webSocket.onopen = function (event)
     {
      console.log('Websocket connection open'); //when the connection is established log this message to the console
     };

     webSocket.onclose = function ()
     {
      console.log("closed")
     }
        var counter = 0; 
		webSocket.onmessage = function (event, err) {
			var e = JSON.parse(event.data); //the data will be retrieved as a JSON string this will parse the data out of that string
			var data = e;
			if (data !== null && typeof data === 'object') //if the data recieved is not null and is of type object
			{
                if(data.Tag =="One Minute"){
                    historical.push(data)
                    counter++
                    if(counter == 50)
                    {
                     buildChart(historical);
                    }

                }else{
                    fiveHistorical.push(data);
                    counter++
                }

			} else {
				current.push(data);
			}
            
		}

		webSocket.close = function (event) {
			console.log("connection closed");
		}
                   var candleWidth = 20;
          var candleGap = 40;
          var candleMargin = 10;
          var wickThickness = "2";
          var hLineColor = "#b5b6b7";
    
          var margin = {top: 20, right: 20, bottom: 20, left: 60},
          width = 940 - margin.left - margin.right,
          height = 640 - margin.top - margin.bottom;

    var historical = [];
            var fiveHistorical = [];
            var current = [];
    var data = [{
                Date: 01 / 12 / 15,
                High: 118.81,
                Low: 116.86,
                Open: 118.75,
                Close: 117.34
            }, {
                Date: 02 / 12 / 15,
                High: 118.11,
                Low: 116.08,
                Open: 117.05,
                Close: 116.28
            }, {
                Date: 03 / 12 / 15,
                High: 116.79,
                Low: 114.22,
                Open: 116.55,
                Close: 115.2
            }, {
                Date: 04 / 12 / 15,
                High: 119.25,
                Low: 115.11,
                Open: 115.29,
                Close: 119.03
            }, {
                Date: 07 / 12 / 15,
                High: 119.86,
                Low: 117.81,
                Open: 118.98,
                Close: 118.28
            }, {
                Date: 05 / 01 / 16,
                High: 105.85,
                Low: 102.41,
                Open: 105.75,
                Close: 102.71
            }, {
                Date: 04 / 02 / 16,
                High: 97.33,
                Low: 95.19,
                Open: 95.86,
                Close: 96.6
            }];

   
   
   
      
    var chart = d3.select("#chart").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      


    chart.append("clipPath")
      .attr("id", "clip")
      .append("rect")
      .attr("width", width)
      .attr("height", height);
      
    chart.append("rect")
      .attr("class", "pane")
      .attr("width", width)
      .attr("height", height)
      .call(zoom)
      .style("fill","none")
      .style("pointer-events", "all");

    var candlestick = chart.append("g")
      .attr("clip-path", "url(#clip)")
      .append("g")
      .attr("class", "candlesticks")
 var grid = chart.append("g")
                             .attr("class", "gridding");

           function buildChart(array) 
            {
                
            var maxi = d3.max(array, function(d){return d.value;}); 
            var maxLow = d3.min(array.map(function(x){return x["Low"];}))
            var maxHigh = d3.max(array.map(function(x){return x["High"];}))
            var maxMinDiff = (maxHigh - maxLow) * 0.1;
            var maxMinDiff = (maxHigh - maxLow) * 0.1;
            function min(a, b){return a < b ? a : b;};
            function max(a, b){return a > b ? a : b;};
               
            var x = d3.scale.linear().domain([-width / 2, width / 2]).range([0, width]);
               var y = d3.scale.linear()
      .domain([maxLow - maxMinDiff, maxHigh + maxMinDiff]) //changed to reflect new variables for lowest, highest and difference to define input domain
      .range([height, 0]); //range has still not been modified ... remember x,y have been reversed to reflect y,x

            
            var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom")
            .tickSize(-height);

            var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .ticks(5)
            .tickSize(-width);
            
             var zoom = d3.behavior.zoom()
              .x(x)
              .y(y)
              .scaleExtent([1, 32])
              .on("zoom", zoomed);
          
              
                  var lines = grid.selectAll("line.y")
                              .data(y.ticks(20))
                              .enter()
                              .append("svg:line")
                              .attr("class", "y")
                              .attr("x1", 0)
                              .attr("x2", width)
                              .attr("y1", y)
                              .attr("y2", y)
                              .attr("stroke", hLineColor);

                var numbers = grid.selectAll("text.yrule")
                                  .data(y.ticks(10))
                                  .enter()
                                  .append("svg:text")
                                  .attr("class", "yrule")
                                  .attr("x", 0)
                                  .attr("y", y)
                                  .attr("dy", 0)
                                  .attr("dx", 20)
                                  .style("fill", "#b5b6b7")
                                  .attr("text-anchor", "middle")


                 var candlestick = chart.append("g")
                .attr("class", "candlesticks")
                .attr("clip-path", "url(#chart-area)")
                .append("g")
                .attr("class", "sticks") 
                

               var wicks = candlestick.selectAll("wick")
                                    .data(array)
                                    .enter()
                                    .append("line")
                                    .attr("x1", function(d, i) {
                                      return candleMargin + candleWidth / 2 + (candleGap * i);
                                    })
                                    .attr("x2", function(d, i) {
                                      return candleMargin + candleWidth / 2 + (candleGap * i);
                                    })
                                    .attr("y1", function(d) {
                                      return y(max(d.High, d.Low));
                                    }) 
                                    .attr("y2", function(d) {
                                      return y(min(d.High, d.Low));
                                    })
                                    .attr("stroke", function(d) {
                                      return d.Open > d.Close ? "#a01f1b" : "#1ba048";
                                    })
                                    .attr("stroke-width", wickThickness);



                var candle = candlestick.selectAll("rect")
                                        .data(array)
                                        .enter()
                                        .append("rect")
                                        .attr("x", function(d, i) {
                                          return candleMargin + (candleGap * i);
                                        })
                                        .attr("y", function(d) {
                                          return y(max(d.Open, d.Close));
                                        })
                                        .attr("height", function(d) {
                                          return y(min(d.Open, d.Close)) - y(max(d.Open, d.Close));
                                        })
                                        .attr("width", function(d) {
                                          return candleWidth
                                        })
                                        .attr("fill", function(d) {
                                          return d.Open > d.Close ? "#a01f1b" : "#1ba048";
                                        })
                                        .style("pointer-events", "none");
                
               
                   
           }
                  
function zoomed() {
      candlestick.attr("transform", "translate(" + d3.event.translate[0] + ")")
    }
                 
         
                </script>


            </div>
        </div>

        <div class="col-lg-2 col-md-1">
            <div class="rightpanel" id="right">
                <h2>right panel</h2>
            </div>
        </div>

        <div class="col-lg-12 col-md-6">
            <div class="bottompanel" id="bottom">
                <!--<h2>bottom panel</h2>-->
                <div class="btn-group btn-group-justified">
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary">30d</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary">1d</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary">3h</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary">30m</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary">15m</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary">5m</button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary">2m</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="clear"></div>

    </div>
    <!--closing div for containter-->
  

    <!--<div class="col-lg-12"> -->
    <!--<div class="container">-->


    <div class="content container-fluid">

        <div class="col-lg-12 col-md-6">
            <div class="footer">
                <h2>Stop Watch Application (c)</h2>
                <h3>Jamie Hyland and Eleanor Noonan</h3>
                <h4>IADT 2017</h4>
            </div>

        </div>

    </div>
    <!--closing div for footer container-->
    <!--</div>-->
    <!--closing div for col-lg-12-->
  
    <!--</div><!--closing div for containter-->


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="scripts/bootstrap.min.js"></script>


</body>

</html>
